<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab 6: Linear Regression | CSC3206</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@mdi/font@3.x/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css">
    <script id="MathJax-script" async="true" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <meta name="description" content="">
    
    <link rel="preload" href="/ai-labs/assets/css/0.styles.1f9910a7.css" as="style"><link rel="preload" href="/ai-labs/assets/js/app.ba4b9885.js" as="script"><link rel="preload" href="/ai-labs/assets/js/2.73478500.js" as="script"><link rel="preload" href="/ai-labs/assets/js/13.8d41ee22.js" as="script"><link rel="prefetch" href="/ai-labs/assets/js/10.b2f09101.js"><link rel="prefetch" href="/ai-labs/assets/js/11.1283164e.js"><link rel="prefetch" href="/ai-labs/assets/js/12.4349f2fc.js"><link rel="prefetch" href="/ai-labs/assets/js/14.bb1b2952.js"><link rel="prefetch" href="/ai-labs/assets/js/15.78b16bcc.js"><link rel="prefetch" href="/ai-labs/assets/js/16.8812cc2d.js"><link rel="prefetch" href="/ai-labs/assets/js/17.8c5d4968.js"><link rel="prefetch" href="/ai-labs/assets/js/18.54c1ff1a.js"><link rel="prefetch" href="/ai-labs/assets/js/19.19d67e19.js"><link rel="prefetch" href="/ai-labs/assets/js/20.d387ab4c.js"><link rel="prefetch" href="/ai-labs/assets/js/21.2b642ecd.js"><link rel="prefetch" href="/ai-labs/assets/js/22.c355de6b.js"><link rel="prefetch" href="/ai-labs/assets/js/23.deab0180.js"><link rel="prefetch" href="/ai-labs/assets/js/24.0721fa94.js"><link rel="prefetch" href="/ai-labs/assets/js/25.de4fe1f6.js"><link rel="prefetch" href="/ai-labs/assets/js/26.21926d96.js"><link rel="prefetch" href="/ai-labs/assets/js/27.96885d6d.js"><link rel="prefetch" href="/ai-labs/assets/js/28.2692ecb7.js"><link rel="prefetch" href="/ai-labs/assets/js/29.25fa17f7.js"><link rel="prefetch" href="/ai-labs/assets/js/3.1bc80255.js"><link rel="prefetch" href="/ai-labs/assets/js/30.ab40dbda.js"><link rel="prefetch" href="/ai-labs/assets/js/31.4ff729df.js"><link rel="prefetch" href="/ai-labs/assets/js/32.a107e3fa.js"><link rel="prefetch" href="/ai-labs/assets/js/33.47fee39e.js"><link rel="prefetch" href="/ai-labs/assets/js/34.d9e43d7d.js"><link rel="prefetch" href="/ai-labs/assets/js/35.e1867e84.js"><link rel="prefetch" href="/ai-labs/assets/js/36.8d391f90.js"><link rel="prefetch" href="/ai-labs/assets/js/37.5b47a054.js"><link rel="prefetch" href="/ai-labs/assets/js/38.c3dcb28c.js"><link rel="prefetch" href="/ai-labs/assets/js/39.1fa67cf9.js"><link rel="prefetch" href="/ai-labs/assets/js/4.87946cba.js"><link rel="prefetch" href="/ai-labs/assets/js/40.2a65f7df.js"><link rel="prefetch" href="/ai-labs/assets/js/41.928f4359.js"><link rel="prefetch" href="/ai-labs/assets/js/42.e185bc4b.js"><link rel="prefetch" href="/ai-labs/assets/js/43.4c4edf22.js"><link rel="prefetch" href="/ai-labs/assets/js/44.372fb442.js"><link rel="prefetch" href="/ai-labs/assets/js/45.bdf80815.js"><link rel="prefetch" href="/ai-labs/assets/js/46.00554e62.js"><link rel="prefetch" href="/ai-labs/assets/js/5.ca16e09f.js"><link rel="prefetch" href="/ai-labs/assets/js/6.8b53973d.js"><link rel="prefetch" href="/ai-labs/assets/js/7.b42291b2.js"><link rel="prefetch" href="/ai-labs/assets/js/8.c1ef89a6.js"><link rel="prefetch" href="/ai-labs/assets/js/9.56ad2de4.js">
    <link rel="stylesheet" href="/ai-labs/assets/css/0.styles.1f9910a7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ai-labs/" class="home-link router-link-active"><!----> <span class="site-name">CSC3206</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/ai-labs/" class="nav-link">
  AI
</a></div><div class="nav-item"><a href="https://ricwtk.github.io/ci-labs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/ai-labs/" class="nav-link">
  AI
</a></div><div class="nav-item"><a href="https://ricwtk.github.io/ci-labs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  CI
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ai-labs/" aria-current="page" class="sidebar-link">Home</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>2021 April</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ai-labs/get-start.html" class="sidebar-link">Getting started</a></li><li><a href="/ai-labs/lab1.html" class="sidebar-link">Lab 1: Basic Python</a></li><li><a href="/ai-labs/lab2.html" class="sidebar-link">Lab 2: Breadth-First Search</a></li><li><a href="/ai-labs/lab3.html" class="sidebar-link">Lab 3: Uniform-Cost Search</a></li><li><a href="/ai-labs/lab4.html" class="sidebar-link">Lab 4: State representation</a></li><li><a href="/ai-labs/lab5.html" class="sidebar-link">Lab 5: pandas</a></li><li><a href="/ai-labs/lab6.html" class="sidebar-link">Lab 6: Linear Regression</a></li><li><a href="/ai-labs/lab7.html" class="sidebar-link">Lab 7: k Nearest Neighbours (KNN)</a></li><li><a href="/ai-labs/lab8.html" class="sidebar-link">Lab 8: Decision Tree</a></li><li><a href="/ai-labs/lab9.html" class="sidebar-link">Lab 9: Clustering</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>Archive</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>2020 August</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading"><span>2020 March</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><p class="sidebar-heading open"><span>2019 August</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/ai-labs/archive/201908/lab1.html" class="sidebar-link">Lab 1: Basic Python</a></li><li><a href="/ai-labs/archive/201908/lab2.html" class="sidebar-link">Lab 2: Breadth-First Search</a></li><li><a href="/ai-labs/archive/201908/lab3.html" class="sidebar-link">Lab 3: Uniform-Cost Search</a></li><li><a href="/ai-labs/archive/201908/lab4.html" class="sidebar-link">Lab 4: State representation</a></li><li><a href="/ai-labs/archive/201908/lab5.html" class="sidebar-link">Lab 5: pandas</a></li><li><a href="/ai-labs/archive/201908/lab6.html" aria-current="page" class="active sidebar-link">Lab 6: Linear Regression</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ai-labs/archive/201908/lab6.html#objectives" class="sidebar-link">Objectives</a></li><li class="sidebar-sub-header"><a href="/ai-labs/archive/201908/lab6.html#dataset" class="sidebar-link">Dataset</a></li><li class="sidebar-sub-header"><a href="/ai-labs/archive/201908/lab6.html#gradient-descent-on-linear-regression-model-with-least-squares-method" class="sidebar-link">Gradient descent on linear regression model with least squares method</a></li><li class="sidebar-sub-header"><a href="/ai-labs/archive/201908/lab6.html#learning-on-linear-regression-model-using-scikit-learn" class="sidebar-link">Learning on linear regression model using scikit-learn</a></li><li class="sidebar-sub-header"><a href="/ai-labs/archive/201908/lab6.html#multivariate-linear-regression" class="sidebar-link">Multivariate linear regression</a></li></ul></li><li><a href="/ai-labs/archive/201908/lab7.html" class="sidebar-link">Lab 7: k Nearest Neighbours (KNN)</a></li><li><a href="/ai-labs/archive/201908/lab8.html" class="sidebar-link">Lab 8: Decision Tree</a></li><li><a href="/ai-labs/archive/201908/lab9.html" class="sidebar-link">Lab 9: Clustering</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="lab-6-linear-regression"><a href="#lab-6-linear-regression" class="header-anchor">#</a> Lab 6: Linear Regression</h1> <h2 id="objectives"><a href="#objectives" class="header-anchor">#</a> Objectives</h2> <ol><li><p>To develop the script to perform gradient descent on linear regression model with least squares method using Python.</p></li> <li><p>To train a linear regression model with least squares method using the <code>scikit-learn</code> Python library.</p></li></ol> <h2 id="dataset"><a href="#dataset" class="header-anchor">#</a> Dataset</h2> <p>Throughout this lab we will be using the data for 442 diabetes patients. The data can be import from the <code>sklearn</code> library.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
diabetes <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_diabetes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><code>diabetes</code> contains the keys of <code>data</code>, <code>target</code>, <code>DESCR</code>, <code>feature_names</code>, <code>data_filename</code>, and <code>target_filename</code>. The description of the diabetes dataset is given by</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span>diabetes<span class="token punctuation">.</span>DESCR<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Task</strong>: What are the keys for the input data and the output/target data?</p> <h2 id="gradient-descent-on-linear-regression-model-with-least-squares-method"><a href="#gradient-descent-on-linear-regression-model-with-least-squares-method" class="header-anchor">#</a> Gradient descent on linear regression model with least squares method</h2> <ol><li><p>Load the dataset as described in the <a href="#dataset">Dataset</a> Section.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> datasets
diabetes <span class="token operator">=</span> datasets<span class="token punctuation">.</span>load_diabetes<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>Convert the dataset into a pandas DataFrame.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
dt <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>diabetes<span class="token punctuation">.</span>data<span class="token punctuation">,</span> columns<span class="token operator">=</span>diabetes<span class="token punctuation">.</span>feature_names<span class="token punctuation">)</span>
y <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>diabetes<span class="token punctuation">.</span>target<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>In machine learning, the common practice is to split the dataset into training data and testing data (some also include the validation data). The testing data is not used during the training phase, but only after training to evaluate the model.</p> <p>The split is normally done such that the training data has a larger portion than the testing data. In this case, let's use a 80-20 split for the training data and testing data.</p> <p><code>sklearn</code> provides a function to split the train-test data given a percentage.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>model_selection <span class="token keyword">import</span> train_test_split
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><strong>Task</strong>: How do you use <code>train_test_split</code> to split the data and target into 80-20 proportion? (Define the training features as <code>X_train</code>, training target as <code>y_train</code>, testing features as <code>X_test</code>, testing target as <code>y_test</code>.)</p></li> <li><p>Before we train the data, a few functions need to be defined. We will start with defining the model of a simple regression line, i.e. $y = mx + c$. Define the function name as <code>model</code> with 3 inputs <code>x</code>, <code>m</code>, and <code>c</code>. The function should return the value of <code>y</code>.</p></li> <li><p>The next function to define is the cost function, i.e.</p> <p>$$ J = \frac{1}{n}\sum_{i=1}^{n} (y_i - \hat{y}_i)^2 $$</p> <p>Name the function as <code>cost</code> with 2 inputs <code>y</code> as the array of target values and <code>yh</code> as the array of predicted target values. The function returns a scalar value of the cost. Assume the arrays are pandas Series.</p></li> <li><p>We also need to define the function to calculate the derivatives of the cost with respect to each parameter. Name the function as <code>derivatives</code> with 3 inputs <code>x</code> as the array of input values, <code>y</code> as the array of of target values, and <code>yh</code> as the array of predicted target values. The function returns a dict object with keys <code>m</code> to hold the value of $\frac{\partial J}{\partial m}$ and <code>c</code> the value of $\frac{\partial J}{\partial c}$. Assume the arrays are pandas Series.</p> <p>$$ \frac{\partial J}{\partial m} = -\frac{2}{n} \sum_{i=1}^{n} x_i (y_i - \hat{y}_i) $$</p> <p>$$ \frac{\partial J}{\partial c} = -\frac{2}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i) $$</p></li> <li><p>We will use <code>bmi</code> as our input feature.</p></li> <li><p>Define the initial values for the parameters.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>learningrate <span class="token operator">=</span> <span class="token number">0.1</span>
m <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
J <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
m<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
J<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cost<span class="token punctuation">(</span>y_train<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>Define the termination conditions.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>J_min <span class="token operator">=</span> <span class="token number">0.01</span>
del_J_min <span class="token operator">=</span> <span class="token number">0.0001</span>
max_iter <span class="token operator">=</span> <span class="token number">10000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><table><thead><tr><th style="text-align:right;">Variable</th> <th style="text-align:left;">Termination condition</th></tr></thead> <tbody><tr><td style="text-align:right;"><code>J_min</code></td> <td style="text-align:left;">The algorithm terminates when the cost is less than this value.</td></tr> <tr><td style="text-align:right;"><code>del_J_min</code></td> <td style="text-align:left;">The algorithm terminates when the proportion of change in cost to the current cost is less than this value.</td></tr> <tr><td style="text-align:right;"><code>max_iter</code></td> <td style="text-align:left;">The algorithm terminates when the number of iteration exceeds this value.</td></tr></tbody></table></li> <li><p>Now develop the code to perform gradient descent.</p> <ol><li>Check termination conditions, if any condition fulfilled, the algorithm is terminated.</li> <li>Calculate derivatives.</li> <li>Update $m$ and $c$; append the new values to the arrays <code>m</code> and <code>c</code>.</li> <li>Calculate $J$; append the value to the array <code>J</code>. Repeat from the beginning.</li></ol></li> <li><p>To provide feedback during each iteration, <code>import sys</code>, and add the following lines as the last lines in the loop.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">)</span>
sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>flush<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>To provide visual display for each iteration, <code>import matplotlib.pyplot as plt</code>. Add these lines before the loop.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training data'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'BMI'</span><span class="token punctuation">)</span>
line <span class="token operator">=</span> <span class="token boolean">None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>Add the following lines as the last lines in the loop.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">if</span> line<span class="token punctuation">:</span>
  line<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token punctuation">)</span>
line <span class="token operator">=</span> plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>pause<span class="token punctuation">(</span><span class="token number">0.001</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><p>Outside of the loop, add the following lines to display the results.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>y_train_pred <span class="token operator">=</span> X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\nAlgorithm terminated with'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">len</span><span class="token punctuation">(</span>J<span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string"> iterations,'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  m </span><span class="token interpolation"><span class="token punctuation">{</span>m<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  c </span><span class="token interpolation"><span class="token punctuation">{</span>c<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  training cost </span><span class="token interpolation"><span class="token punctuation">{</span>J<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
testcost <span class="token operator">=</span> cost<span class="token punctuation">(</span>y_test<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test_pred<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  testing cost </span><span class="token interpolation"><span class="token punctuation">{</span>testcost<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p>Test the result on the testing data.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> \
         X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> model<span class="token punctuation">(</span>x<span class="token punctuation">,</span> m<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> c<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> \
         <span class="token string">'-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Testing data'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li></ol> <h2 id="learning-on-linear-regression-model-using-scikit-learn"><a href="#learning-on-linear-regression-model-using-scikit-learn" class="header-anchor">#</a> Learning on linear regression model using scikit-learn</h2> <ol><li><p><code>scikit-learn</code> provides model and functions to perform linear regression easily.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> sklearn <span class="token keyword">import</span> linear_model
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Create a linear regression model.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>regrmodel <span class="token operator">=</span> linear_model<span class="token punctuation">.</span>LinearRegression<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>Train the model with the training data.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>regrmodel<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p><code>regrmodel</code> is now a trained model. To get the predicted $y$ given a set of $x$ values,</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>y_train_pred <span class="token operator">=</span> regrmodel<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
y_test_pred <span class="token operator">=</span> regrmodel<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>As we are using pandas data structures, we need to convert the predicted value to Series and align the indices with the target Series.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>y_train_pred <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>y_train_pred<span class="token punctuation">)</span>
y_train_pred<span class="token punctuation">.</span>index <span class="token operator">=</span> y_train<span class="token punctuation">.</span>index

y_test_pred <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>y_test_pred<span class="token punctuation">)</span>
y_test_pred<span class="token punctuation">.</span>index <span class="token operator">=</span> y_test<span class="token punctuation">.</span>index
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li><p>Display the information of the fitted model.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'sklearn'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  m </span><span class="token interpolation"><span class="token punctuation">{</span>regrmodel<span class="token punctuation">.</span>coef_<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  c </span><span class="token interpolation"><span class="token punctuation">{</span>regrmodel<span class="token punctuation">.</span>intercept_<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
traincost <span class="token operator">=</span> cost<span class="token punctuation">(</span>y_train<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train_pred<span class="token punctuation">)</span>
testcost <span class="token operator">=</span> cost<span class="token punctuation">(</span>y_test<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test_pred<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  training cost: </span><span class="token interpolation"><span class="token punctuation">{</span>traincost<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'  testing cost: </span><span class="token interpolation"><span class="token punctuation">{</span>testcost<span class="token punctuation">}</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li><p>Display the result of prediction together with the target values.</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code>plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train_pred<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Training data (sklearn)'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'BMI'</span><span class="token punctuation">)</span>

plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test_pred<span class="token punctuation">,</span> <span class="token string">'-'</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Testing data (sklearn)'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'BMI'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li></ol> <h2 id="multivariate-linear-regression"><a href="#multivariate-linear-regression" class="header-anchor">#</a> Multivariate linear regression</h2> <ol><li><p>Linear regression can also be applied with multiple inputs. With $k$ inputs, the linear regression equation is given as</p> <p>$$ \hat{y} = \beta + m_1x_1 + m_2x_2 + \cdots + m_kx_k $$</p></li> <li><p>With one input, the resultant function is a line; with two inputs, the resultant function is a plane; with more inputs, it's a hyperplane.</p></li> <li><p>Gradient descent for multivariate linear regression is performed with the same approach.</p> <ol><li>Check termination conditions, if any condition fulfilled, the algorithm is terminated.</li> <li>Calculate derivatives.</li> <li>Update $m_1$, $m_2$, ..., $m_k$ and $\beta$.</li> <li>Calculate $J$. Repeat from the beginning.</li></ol></li> <li><p>For multivariate linear regression, the least squares cost is given by
$$ J = \frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2 $$</p> <p>The derivative with respect to $\beta$
$$ \frac{\partial J}{\partial \beta} = -\frac{2}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i) $$</p> <p>The derivatives with respect to $m_j$
$$ \frac{\partial J}{\partial m_j} = -\frac{2}{n} \sum_{i=1}^{n} x_{ji}(y_i - \hat{y}_i) $$</p></li> <li><p>Using <code>scikit-learn</code> functions, multivariate linear regression can be achieved by providing the input features to the function.</p></li> <li><p>We will now use the <code>bmi</code> and blood pressure <code>bp</code> as the input features to predict the target. Copy the code block from the previous section and change <code>X_...[['bmi']]</code> to <code>X_...[['bmi','bp']]</code> except for the plotting part.</p></li> <li><p>For the graphical visualisation (plotting) part, use the following code to plot 3d graphs:</p> <div class="language-python line-numbers-mode"><pre class="language-python"><code><span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_train<span class="token punctuation">[</span><span class="token string">'bp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_train<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_train<span class="token punctuation">[</span><span class="token string">'bp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_train_pred<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'BMI'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Blood pressure'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Training data (sklearn multivariate)'</span><span class="token punctuation">)</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> projection<span class="token operator">=</span><span class="token string">'3d'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_test<span class="token punctuation">[</span><span class="token string">'bp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test<span class="token punctuation">[</span><span class="token string">'target'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>scatter<span class="token punctuation">(</span>X_test<span class="token punctuation">[</span><span class="token string">'bmi'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> X_test<span class="token punctuation">[</span><span class="token string">'bp'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y_test_pred<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'green'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'BMI'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'Blood pressure'</span><span class="token punctuation">)</span>
ax<span class="token punctuation">.</span>set_title<span class="token punctuation">(</span><span class="token string">'Testing data (sklearn multivariate)'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div></li></ol></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">3/25/2020, 3:59:34 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ai-labs/archive/201908/lab5.html" class="prev">
        Lab 5: pandas
      </a></span> <span class="next"><a href="/ai-labs/archive/201908/lab7.html">
        Lab 7: k Nearest Neighbours (KNN)
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ai-labs/assets/js/app.ba4b9885.js" defer></script><script src="/ai-labs/assets/js/2.73478500.js" defer></script><script src="/ai-labs/assets/js/13.8d41ee22.js" defer></script>
  </body>
</html>
